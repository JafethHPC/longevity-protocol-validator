<div class="min-h-screen bg-stone-100 flex flex-col">
  <header
    class="bg-white border-b border-stone-200 py-4 px-6 flex items-center justify-between shadow-sm"
  >
    <div class="flex items-center gap-3">
      <div
        class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center shadow-md"
      >
        <svg
          class="w-6 h-6 text-white"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
          />
        </svg>
      </div>
      <div>
        <h1 class="text-xl font-bold text-stone-800">
          {{ "app.title" | translate }}
        </h1>
        <p class="text-sm text-stone-500">
          {{ "app.subtitle" | translate }}
        </p>
      </div>
    </div>

    <div *ngIf="state.hasReport()" class="flex items-center gap-2">
      <button
        (click)="exportPdf()"
        class="px-4 py-2 text-sm font-medium text-stone-600 hover:text-stone-700 hover:bg-stone-100 rounded-lg transition-colors flex items-center gap-2"
      >
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
          />
        </svg>
        {{ "header.export-pdf" | translate }}
      </button>
      <button
        (click)="newReport()"
        class="px-4 py-2 text-sm font-medium text-emerald-600 hover:text-emerald-700 hover:bg-emerald-50 rounded-lg transition-colors"
      >
        {{ "header.new-report" | translate }}
      </button>
    </div>
  </header>

  <main class="flex-1 overflow-auto p-6">
    <app-search-input
      *ngIf="!state.hasReport() && !state.isLoading()"
      (search)="generateReport($event)"
    />

    <app-research-progress
      *ngIf="state.isLoading()"
      [progress]="state.progress()"
    />

    <div
      *ngIf="state.hasReport() && !state.isLoading()"
      class="max-w-4xl mx-auto"
    >
      <app-report-header [report]="state.report()!" />

      <app-tab-bar
        [tabs]="tabs()"
        [activeTab]="state.activeTab()"
        (tabChange)="state.setActiveTab($event)"
      />

      <div class="mt-6">
        <app-findings-tab
          *ngIf="state.activeTab() === 'findings'"
          [report]="state.report()!"
        />

        <app-protocols-tab
          *ngIf="state.activeTab() === 'protocols'"
          [report]="state.report()!"
        />

        <app-sources-tab
          *ngIf="state.activeTab() === 'sources'"
          [report]="state.report()!"
          [expandedSources]="state.expandedSources()"
          (toggleSourceExpanded)="state.toggleSourceExpanded($event)"
        />
      </div>

      <app-follow-up-section
        [messages]="state.followUpMessages()"
        [isLoading]="state.isFollowUpLoading()"
        (askQuestion)="askFollowUp($event)"
      />
    </div>
  </main>
</div>
